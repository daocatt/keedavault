# æ•°æ®åº“æ–‡ä»¶æŸåç´§æ€¥æ¢å¤æŒ‡å—

## ğŸš¨ é”™è¯¯ä¿¡æ¯

```
vaultAuth 
Error FileCorrupt: not enough data
```

## ğŸ” é—®é¢˜åˆ†æ

è¿™ä¸ªé”™è¯¯è¡¨æ˜æ•°æ®åº“æ–‡ä»¶æŸåæˆ–ä¸å®Œæ•´ï¼Œå¯èƒ½åŸå› ï¼š
1. ä¿å­˜è¿‡ç¨‹ä¸­æ–­
2. éªŒè¯å¤±è´¥ä½†æ–‡ä»¶å·²è¢«æ›¿æ¢
3. ç£ç›˜ç©ºé—´ä¸è¶³
4. æƒé™é—®é¢˜å¯¼è‡´å†™å…¥ä¸å®Œæ•´

## âœ… ç´§æ€¥æ¢å¤æ­¥éª¤

### æ­¥éª¤ 1: æ£€æŸ¥å¤‡ä»½æ–‡ä»¶

#### A. æœ¬åœ°æ•°æ®åº“å¤‡ä»½

```bash
# æŸ¥çœ‹æ•°æ®åº“åŒç›®å½•çš„å¤‡ä»½
ls -lht /path/to/database/*.backup.*.kdbx

# ç¤ºä¾‹
ls -lht ~/Documents/*.backup.*.kdbx
```

#### B. äº‘å­˜å‚¨æ•°æ®åº“å¤‡ä»½

```bash
# æŸ¥çœ‹åº”ç”¨æ•°æ®ç›®å½•çš„å¤‡ä»½
ls -lht ~/Library/Application\ Support/com.bsdev.keedavault/backups/*.backup.*.kdbx
```

### æ­¥éª¤ 2: æ¢å¤å¤‡ä»½

#### æ–¹æ³• 1: ä½¿ç”¨æœ€æ–°å¤‡ä»½

```bash
# æ‰¾åˆ°æœ€æ–°çš„å¤‡ä»½æ–‡ä»¶
cd /path/to/database/

# å¤‡ä»½æŸåçš„æ–‡ä»¶
mv vault.kdbx vault.kdbx.corrupted

# æ¢å¤æœ€æ–°å¤‡ä»½
cp vault.backup.2025-12-12T21-30-00.kdbx vault.kdbx
```

#### æ–¹æ³• 2: ä»åº”ç”¨æ•°æ®ç›®å½•æ¢å¤

```bash
# è¿›å…¥å¤‡ä»½ç›®å½•
cd ~/Library/Application\ Support/com.bsdev.keedavault/backups/

# æŸ¥çœ‹å¤‡ä»½
ls -lht *.backup.*.kdbx

# å¤åˆ¶æœ€æ–°å¤‡ä»½åˆ°åŸä½ç½®
cp bt961p0000000000.backup.2025-12-12T21-30-00.kdbx /path/to/vault.kdbx
```

### æ­¥éª¤ 3: éªŒè¯æ¢å¤çš„æ–‡ä»¶

1. åœ¨ KeedaVault ä¸­æ‰“å¼€æ¢å¤çš„æ–‡ä»¶
2. è¾“å…¥å¯†ç 
3. æ£€æŸ¥æ•°æ®æ˜¯å¦å®Œæ•´

## ğŸ› ï¸ ä¸´æ—¶ç¦ç”¨éªŒè¯ï¼ˆå¦‚æœæ²¡æœ‰å¤‡ä»½ï¼‰

å¦‚æœæ²¡æœ‰å¯ç”¨çš„å¤‡ä»½ï¼Œå¯ä»¥ä¸´æ—¶ç¦ç”¨éªŒè¯åŠŸèƒ½ï¼š

### ä¿®æ”¹ä»£ç 

**æ–‡ä»¶**: `context/VaultContext.tsx`

æ‰¾åˆ° `saveVault` å‡½æ•°ä¸­çš„è¿™ä¸€è¡Œï¼š

```typescript
const result = await safeSaveDatabase(vault.path, vault.db, {
    createBackup: autoBackupEnabled,
    maxBackups: 2,
    verifyAfterWrite: true,  // â† æ”¹ä¸º false
    silent: isAutoSave
});
```

æ”¹ä¸ºï¼š

```typescript
const result = await safeSaveDatabase(vault.path, vault.db, {
    createBackup: autoBackupEnabled,
    maxBackups: 2,
    verifyAfterWrite: false,  // â† ç¦ç”¨éªŒè¯
    silent: isAutoSave
});
```

**é‡å¯åº”ç”¨å**:
- éªŒè¯å°†è¢«è·³è¿‡
- å¯ä»¥ä¿å­˜æ–‡ä»¶
- ä½†å¤±å»äº†æ•°æ®å®Œæ•´æ€§ä¿æŠ¤

## ğŸ” æ£€æŸ¥æ–‡ä»¶å¤§å°

### æŸåçš„æ–‡ä»¶

```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°
ls -lh vault.kdbx

# å¦‚æœæ˜¾ç¤º 0 å­—èŠ‚æˆ–éå¸¸å°ï¼ˆ< 1KBï¼‰ï¼Œæ–‡ä»¶å·²æŸå
-rw-r--r--  1 user  staff     0B  vault.kdbx  â† æŸå
```

### æ­£å¸¸çš„æ–‡ä»¶

```bash
# æ­£å¸¸çš„ KDBX æ–‡ä»¶åº”è¯¥è‡³å°‘æœ‰å‡  KB
-rw-r--r--  1 user  staff   5.2K  vault.kdbx  â† æ­£å¸¸
```

## ğŸ“Š æ¢å¤ç­–ç•¥

### ç­–ç•¥ 1: ä½¿ç”¨æœ€æ–°å¤‡ä»½ï¼ˆæ¨èï¼‰

```
1. æ‰¾åˆ°æœ€æ–°å¤‡ä»½
2. å¤åˆ¶åˆ°åŸä½ç½®
3. æ‰“å¼€éªŒè¯
4. ç»§ç»­ä½¿ç”¨
```

**ä¼˜ç‚¹**: 
- âœ… æ•°æ®å®Œæ•´
- âœ… å®‰å…¨å¯é 

**ç¼ºç‚¹**:
- âŒ å¯èƒ½ä¸¢å¤±æœ€è¿‘çš„ä¿®æ”¹

### ç­–ç•¥ 2: ä½¿ç”¨ KeePassXC ä¿®å¤

```
1. ç”¨ KeePassXC æ‰“å¼€æŸåçš„æ–‡ä»¶
2. KeePassXC å¯èƒ½èƒ½å¤Ÿä¿®å¤
3. ä¿å­˜ä¸ºæ–°æ–‡ä»¶
4. åœ¨ KeedaVault ä¸­æ‰“å¼€æ–°æ–‡ä»¶
```

**ä¼˜ç‚¹**:
- âœ… å¯èƒ½æ¢å¤æ›´å¤šæ•°æ®

**ç¼ºç‚¹**:
- âŒ éœ€è¦å®‰è£… KeePassXC
- âŒ ä¸ä¿è¯æˆåŠŸ

### ç­–ç•¥ 3: ä»å¤´å¼€å§‹ï¼ˆæœ€åæ‰‹æ®µï¼‰

```
1. åˆ›å»ºæ–°æ•°æ®åº“
2. æ‰‹åŠ¨é‡æ–°è¾“å…¥æ•°æ®
```

**ä¼˜ç‚¹**:
- âœ… å¹²å‡€çš„å¼€å§‹

**ç¼ºç‚¹**:
- âŒ ä¸¢å¤±æ‰€æœ‰æ•°æ®

## ğŸ”§ é¢„é˜²æªæ–½

### 1. å¯ç”¨è‡ªåŠ¨å¤‡ä»½

ç¡®ä¿è®¾ç½®ä¸­å¯ç”¨äº†è‡ªåŠ¨å¤‡ä»½ï¼š

```
Settings â†’ Security â†’ Data Protection
â˜‘ Auto Backup (keeps 2 most recent backups)
```

### 2. å®šæœŸæ‰‹åŠ¨å¤‡ä»½

```bash
# å®šæœŸå¤åˆ¶æ•°æ®åº“åˆ°å®‰å…¨ä½ç½®
cp vault.kdbx ~/Backups/vault-$(date +%Y%m%d).kdbx
```

### 3. ä½¿ç”¨äº‘å­˜å‚¨

å°†æ•°æ®åº“æ”¾åœ¨äº‘å­˜å‚¨ä¸­ï¼ˆiCloudã€Dropboxï¼‰ï¼š
- è‡ªåŠ¨åŒæ­¥
- ç‰ˆæœ¬å†å²
- å¤šè®¾å¤‡è®¿é—®

### 4. å¯¼å‡ºä¸º XML

å®šæœŸå¯¼å‡ºä¸º XML æ ¼å¼ï¼š
```
Database â†’ Export â†’ XML
```

## ğŸš¨ ç´§æ€¥è”ç³»

### æŸ¥çœ‹æ—¥å¿—

åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼š

```
F12 â†’ Console
```

æŸ¥æ‰¾ï¼š
- ä¿å­˜å¤±è´¥çš„è¯¦ç»†ä¿¡æ¯
- éªŒè¯é”™è¯¯
- æ–‡ä»¶ç³»ç»Ÿé”™è¯¯

### æ£€æŸ¥ç£ç›˜ç©ºé—´

```bash
# macOS
df -h

# ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´
```

### æ£€æŸ¥æ–‡ä»¶æƒé™

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -l vault.kdbx

# åº”è¯¥æ˜¯å¯è¯»å†™
-rw-r--r--  1 user  staff  vault.kdbx
```

## ğŸ“ æŠ¥å‘Šé—®é¢˜

å¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·æä¾›ï¼š

1. **é”™è¯¯ä¿¡æ¯**
   - å®Œæ•´çš„é”™è¯¯å †æ ˆ
   - æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—

2. **æ–‡ä»¶ä¿¡æ¯**
   ```bash
   ls -lh vault.kdbx
   file vault.kdbx
   ```

3. **å¤‡ä»½ä¿¡æ¯**
   ```bash
   ls -lht *.backup.*.kdbx
   ```

4. **æ“ä½œæ­¥éª¤**
   - å¦‚ä½•è§¦å‘é”™è¯¯
   - ä¹‹å‰åšäº†ä»€ä¹ˆæ“ä½œ

## âœ… æ¢å¤æ£€æŸ¥æ¸…å•

- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å¤‡ä»½æ–‡ä»¶
- [ ] æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶å¤§å°ï¼ˆåº”è¯¥ > 1KBï¼‰
- [ ] å°è¯•ç”¨ KeedaVault æ‰“å¼€å¤‡ä»½
- [ ] å¦‚æœå¤±è´¥ï¼Œå°è¯•ç”¨ KeePassXC æ‰“å¼€
- [ ] æ¢å¤æˆåŠŸåï¼ŒéªŒè¯æ•°æ®å®Œæ•´æ€§
- [ ] å¯ç”¨è‡ªåŠ¨å¤‡ä»½
- [ ] åˆ›å»ºé¢å¤–çš„æ‰‹åŠ¨å¤‡ä»½

## ğŸ¯ å¿«é€Ÿæ¢å¤å‘½ä»¤

### æœ¬åœ°æ•°æ®åº“

```bash
# 1. è¿›å…¥æ•°æ®åº“ç›®å½•
cd ~/Documents

# 2. å¤‡ä»½æŸåæ–‡ä»¶
mv vault.kdbx vault.kdbx.corrupted

# 3. æ¢å¤æœ€æ–°å¤‡ä»½
cp $(ls -t vault.backup.*.kdbx | head -1) vault.kdbx

# 4. éªŒè¯
ls -lh vault.kdbx
```

### äº‘å­˜å‚¨æ•°æ®åº“

```bash
# 1. è¿›å…¥å¤‡ä»½ç›®å½•
cd ~/Library/Application\ Support/com.bsdev.keedavault/backups

# 2. æ‰¾åˆ°æœ€æ–°å¤‡ä»½
ls -t *.backup.*.kdbx | head -1

# 3. å¤åˆ¶åˆ°åŸä½ç½®ï¼ˆæ›¿æ¢ /path/to/vault.kdbxï¼‰
cp $(ls -t *.backup.*.kdbx | head -1) /Users/username/Dropbox/vault.kdbx
```

## ğŸ’¡ æ€»ç»“

**ç«‹å³è¡ŒåŠ¨**:
1. âœ… æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
2. âœ… æ¢å¤æœ€æ–°å¤‡ä»½
3. âœ… éªŒè¯æ•°æ®å®Œæ•´æ€§

**é•¿æœŸæªæ–½**:
1. âœ… å¯ç”¨è‡ªåŠ¨å¤‡ä»½
2. âœ… å®šæœŸæ‰‹åŠ¨å¤‡ä»½
3. âœ… ä½¿ç”¨äº‘å­˜å‚¨
4. âœ… å¯¼å‡º XML å‰¯æœ¬

**å¦‚æœæ²¡æœ‰å¤‡ä»½**:
1. âš ï¸ ä¸´æ—¶ç¦ç”¨éªŒè¯
2. âš ï¸ å°è¯•ç”¨ KeePassXC ä¿®å¤
3. âš ï¸ è€ƒè™‘ä»å¤´å¼€å§‹

è®°ä½ï¼š**æ•°æ®æ— ä»·ï¼Œå¤‡ä»½ç¬¬ä¸€ï¼**
